# Client Raspberry Pi â€” one container per node
# Node source lives in ../nodes/; no node code under client/
# Run: docker compose up -d ros2-master
# Run master2master: docker compose up -d ros2-master master2master
# Bridges use profiles so they can be started independently

services:
  ros2-master:
    build:
      context: ../nodes/ros2_master
      dockerfile: Dockerfile
    image: ros2-lerobot-sverve-platform/client-ros2-master:latest
    restart: unless-stopped
    networks:
      - client

  master2master:
    build:
      context: ../nodes/master2master
      dockerfile: Dockerfile
    image: ros2-lerobot-sverve-platform/client-master2master:latest
    restart: unless-stopped
    environment:
      - ROS_DOMAIN_ID=0
    volumes:
      - master2master_config:/etc/ros2/master2master:ro
    networks:
      - client

  uvc_camera_0:
    build:
      context: ../nodes/bridges/uvc_camera
      dockerfile: Dockerfile
    image: ros2-lerobot-sverve-platform/client-uvc-camera:latest
    restart: unless-stopped
    environment:
      UVC_DEVICE: /dev/video0
      UVC_TOPIC: /camera_0/image_raw
    profiles:
      - uvc
    networks:
      - client

  uvc_camera_1:
    image: ros2-lerobot-sverve-platform/client-uvc-camera:latest
    restart: unless-stopped
    environment:
      UVC_DEVICE: /dev/video2
      UVC_TOPIC: /camera_1/image_raw
    profiles:
      - uvc
    networks:
      - client

  realsense:
    image: ros:jazzy-ros-base
    command: ["sleep", "infinity"]
    restart: unless-stopped
    profiles:
      - realsense
    networks:
      - client

  rplidar:
    image: ros:jazzy-ros-base
    command: ["sleep", "infinity"]
    restart: unless-stopped
    profiles:
      - lidar
    networks:
      - client

  imu:
    image: ros:jazzy-ros-base
    command: ["sleep", "infinity"]
    restart: unless-stopped
    profiles:
      - imu
    networks:
      - client

  gps_rtk:
    image: ros:jazzy-ros-base
    command: ["sleep", "infinity"]
    restart: unless-stopped
    profiles:
      - gps
    networks:
      - client

  lerobot_follower:
    build:
      context: ../nodes/bridges/lerobot_joints
      dockerfile: Dockerfile
    image: ros2-lerobot-sverve-platform/client-lerobot-follower:latest
    restart: unless-stopped
    environment:
      LEROBOT_NAMESPACE: follower
    profiles:
      - lerobot
    networks:
      - client

  lerobot_teleop:
    build:
      context: ../nodes/lerobot_teleop
      dockerfile: Dockerfile
    image: ros2-lerobot-sverve-platform/client-lerobot-teleop:latest
    restart: unless-stopped
    profiles:
      - lerobot
    networks:
      - client

  swerve:
    image: ros:jazzy-ros-base
    command: ["sleep", "infinity"]
    restart: unless-stopped
    profiles:
      - swerve
    networks:
      - client

volumes:
  master2master_config:

networks:
  client:
    driver: bridge

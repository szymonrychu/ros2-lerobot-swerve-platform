---
# Server — Raspberry Pi 4b: Lerobot SO-101 leader, GPS-RTK LC29H(BS)
# Network (netplan) and hostname — set for each host or here for the group:
network_address: "192.168.1.33/24"

# Monitoring stack (Alloy, Mimir, Loki, Grafana). Override in host_vars if needed.
monitoring_mimir_retention: "8h"
monitoring_loki_retention: "8h"
monitoring_alloy_scrape_interval: "1s"
monitoring_grafana_http_port: 8080
monitoring_data_dir: /var/lib/monitoring

network_gateway: "192.168.1.1"
network_nameservers: ["1.1.1.1"]
hostname: "server-rpi4"

# ROS2 node types: image and default settings per type (used by ros2_node_deploy).
# Server ROS2 master binds to all interfaces (0.0.0.0) so Client can connect; other nodes use localhost only.
ros2_node_type_defaults:
  ros2_master:
    image: harbor.szymonrichert.pl/containers/server-ros2-master:latest
    build_context: nodes/ros2_master
    env:
      - ROS_LOCALHOST_ONLY=0
  feetech_servos:
    image: harbor.szymonrichert.pl/containers/server-feetech-servos-leader:latest
    build_context: nodes/bridges/feetech_servos
    config_path: /etc/ros2/feetech_servos
    env:
      - ROS_LOCALHOST_ONLY=0
      - ROS_AUTOMATIC_DISCOVERY_RANGE=SUBNET
      - FEETECH_SERVOS_CONFIG=/etc/ros2/feetech_servos/config.yaml

# Nodes to deploy: name, node_type, present, enabled, config.
ros2_nodes:
  - name: ros2-master
    node_type: ros2_master
    present: true
    enabled: true
    extra_args: --network host --ipc host
  - name: lerobot_leader
    node_type: feetech_servos
    present: true
    enabled: true
    extra_args: >-
      --network host
      --ipc host
      --device=/dev/ttyACM0:/dev/ttyACM0
      --mount type=bind,src=/dev/serial/by-id,dst=/dev/serial/by-id,readonly
    config: |
      device: /dev/serial/by-id/usb-1a86_USB_Single_Serial_5A7A059057-if00
      namespace: leader
      log_joint_updates: true
      enable_torque_on_start: false
      control_loop_hz: 180
      joint_names:
        - name: joint_1
          id: 1
        - name: joint_2
          id: 2
        - name: joint_3
          id: 3
        - name: joint_4
          id: 4
        - name: joint_5
          id: 5
        - name: joint_6
          id: 6
